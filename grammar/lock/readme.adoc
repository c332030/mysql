
= mysql lock
:toc: right

没有索引时，会锁表

== 间隙锁

查询不会加间隙锁（加上 for update 会锁），新增、修改、删除会

通过 next-key 锁（记录锁和间隙锁的组合）来锁住记录本身和记录之间的“间隙”

在 InnoDB 事务中，对记录加锁带基本单位是 next-key 锁，但是会因为一些条件会退化成间隙锁，或者记录锁。加锁的位置准确的说，锁是加在索引上的而非行上。

比如，在 update 语句的 where 条件使用了唯一索引，那么 next-key 锁会退化成记录锁，也就是只会给一行记录加锁。
